Array.prototype.indexOf||(Array.prototype.indexOf=function(h,l){l=l||0;for(var m=this.length;l<m;){if(this[l]===h)return l;++l}return-1});Array.prototype.remove=function(){for(var h,l=arguments,m=l.length,p;m&&this.length;)for(h=l[--m];-1!=(p=this.indexOf(h));)this.splice(p,1);return this};
function LightMap(h){function l(c,b,d,g){b=b*a.originShift/180;c=Math.log(Math.tan((90+c)*Math.PI/360))/(Math.PI/180);c=c*a.originShift/180;b={x:b,y:c};c=b.x;var e=b.y;b=a.initialResolution/parseFloat(Math.pow(2,d));e=(e+a.originShift)/b;c=parseInt(Math.ceil((c+a.originShift)/b/parseFloat(a.tileSize))-1);b=parseInt(Math.ceil(e/parseFloat(a.tileSize))-1);b={x:c,y:b};return g?b:s(b.x,b.y,d)}function m(c,b,d){res=a.initialResolution/parseFloat(Math.pow(2,d));mx=c*res-a.originShift;my=b*res-a.originShift;
return{x:mx,y:my}}function p(c,b){var d=180*(c/a.originShift),g=180*(b/a.originShift),g=180/Math.PI*(2*Math.atan(Math.exp(g*Math.PI/180))-Math.PI/2);return{lat:g,lon:d}}function s(a,b,d){return{x:a,y:Math.pow(2,d)-1-b,ty:b}}function t(c,b,d){var g=m(c*a.tileSize,b*a.tileSize,d);c=m((c+1)*a.tileSize,(b+1)*a.tileSize,d);c=[g.x,g.y,c.x,c.y];g=p(c[0],c[1]);c=p(c[2],c[3]);return[g.lat,g.lon,c.lat,c.lon]}function A(){for(var c=0;c<a.markers.length;c++)a.markers[c].boundsChanged()}function u(c,b){if(!a.movingMap)try{var d=
c,g=b,e=0,f=0;d<-a.rightEdge&&(d=-a.rightEdge,e=1);g<-a.topEdge&&(g=-a.topEdge,f=1);d>a.leftEdge&&(d=a.leftEdge,e=-1);g>a.bottomEdge&&(g=a.bottomEdge,f=-1);if(!(0==e&&0==f||a.reallocating)){a.reallocating=!0;var j=a.XnumberOfTiles+(0!=e?1:0),h=a.YnumberOfTiles+(0!=f?1:0),q=1*e,k=1*f;a.Xcenter+=q;a.Ycenter+=k;a.center.x+=q;a.center.y+=k;0>e&&(a.leftEdge+=-1*q*a.tileSize);0>f&&(a.bottomEdge+=-1*k*a.tileSize);0<e&&(a.rightEdge+=q*a.tileSize);0<f&&(a.topEdge+=k*a.tileSize);for(var l=[],n=0;n<j;n++){l.push([]);
for(var r=0;r<h;r++){var m=a.center.x-a.Xcenter+n+q+a.minX,v=a.center.y-a.Ycenter+r+k+a.minY;0<=n+q&&n+q<a.XnumberOfTiles&&r+k<a.YnumberOfTiles&&0<=r+k?l[n].push(a.tiles[n+q][r+k]):(l[n].push(B(a.map,a.zoom,m,v,n+q+a.minX,r+k+a.minY)),a.getTile(l[n][r],a.zoom,m,v,n+q+a.minX,r+k+a.minY));if(0==n&&0==r){var p=s(m,v,a.zoom),w=t(p.x,p.y,a.zoom);a.bounds[2]=w[2];a.bounds[1]=w[1];a.boundsTMS[2]=m;a.boundsTMS[1]=v}else n+1==j&&r+1==h&&(p=s(m,v,a.zoom),w=t(p.x,p.y,a.zoom),a.bounds[0]=w[0],a.bounds[3]=w[3],
a.boundsTMS[0]=m,a.boundsTMS[3]=v)}}a.XnumberOfTiles=j;a.YnumberOfTiles=h;a.tiles=null;a.tiles=l;0>e&&(a.minX+=q);0>f&&(a.minY+=k);A();a.reallocating=!1}a.map.style.left=d+"px";a.map.style.top=g+"px";a.xOffset=d;a.yOffset=g}catch(u){alert(u)}}function C(c,b,d,g,e){var f=2*c-1;if(!(f>b&&f>d&&0!=b%2&&0!=d%2||f>b+1&&f>d&&0==b%2&&0!=d%2||f>b&&f>d+1&&0!=b%2&&0==d%2||f>b+1&&f>d+1&&0==b%2&&0==d%2)){if(2>c)1==c&&a.getTile(a.tiles[g][e],a.zoom,a.center.x-a.Xcenter+g,a.center.y-a.Ycenter+e,g,e);else for(f=
g-c+1;f<g+c;f++)for(var j=e-c+1;j<e+c;j++)f<b&&(j<d&&(f==g-c+1||f==g+c-1||j==e-c+1||j==e+c-1)&&0<=f&&0<=j)&&a.getTile(a.tiles[f][j],a.zoom,a.center.x-a.Xcenter+f,a.center.y-a.Ycenter+j,f,j);C(c+1,b,d,g,e)}}function x(c,b,d,g,e){var f=l(c,b,e,!1);e=t(f.x,f.ty,e);return{x:(1-(e[3]-b)/(e[3]-e[1]))*a.tileSize+(f.x-d)*a.tileSize,y:(e[2]-c)/(e[2]-e[0])*a.tileSize+(f.y-g)*a.tileSize}}function B(c,b,d,g,e,f){e=parseInt(e*a.tileSize)+"px";f=parseInt(f*a.tileSize)+"px";b=[];d=document.createElement("img");
d.src=a.loading;d.style.left=e;d.style.top=f;d.style.position="absolute";d.style.zIndex=0;b.push(d);c.appendChild(d);return b}function y(a,b){this.x=a;this.y=b}var a=this;this.withInViewport=function(c,b){if(!a.withinBounds(c,b))return!1;var d=x(c,b,a.zeroTile.x,a.zeroTile.y,a.zoom);return d.x>-1*a.xOffset&&d.x<a.width+-1*a.xOffset&&d.y>-1*a.yOffset&&d.y<a.height+-1*a.yOffset};this.moveMap=function(c,b){u(parseInt(a.xOffset+c*-a.tileSize),parseInt(a.yOffset+b*-a.tileSize));a.fireEvent("idle")};this.AddListener=
function(a,b,d){a.attachEvent?(a["e"+b+d]=d,a[b+d]=function(){a["e"+b+d](window.event)},a.attachEvent("on"+b,a[b+d])):a.addEventListener(b,d,!1)};this.removeListener=function(a,b,d){a.detachEvent?(a.detachEvent("on"+b,a[b+d]),a[b+d]=null):a.removeEventListener(b,d,!1)};this.fireEvent=function(a){if(document.addEventListener){var b=document.createEvent("UIEvents");b.initEvent(a,!1,!1);document.dispatchEvent(b)}else document.attachEvent&&document.documentElement[a]++};this.addCustomEvent=function(a,
b){document.addEventListener?document.addEventListener(a,function(a){b(a)},!1):document.attachEvent&&(document.documentElement[a]=0,document.documentElement.attachEvent("onpropertychange",function(d){d.propertyName==a&&b(d)}))};this.getURL=function(a,b,d){var g=["a","b","c"];return"http://"+g[Math.floor(Math.random()*g.length)]+".tile.openstreetmap.org/"+a+"/"+b+"/"+d+".png"};this.getTile=function(c,b,d,g,e,f){e=parseInt(e*a.tileSize)+"px";f=parseInt(f*a.tileSize)+"px";var j=document.createElement("img");
j.src=a.getURL(b,d,g);j.style.zIndex=0;j.style.left=e;j.style.top=f;j.name="default";j.style.position="absolute";a.firsttime&&(j.id="default"+b+"_"+d+"_"+g);for(;0<c.length;)c[0].parentNode.removeChild(c[0]),c.remove(c[0]);a.map.appendChild(j);c.push(j)};this.getAllTiles=function(){C(1,a.XnumberOfTiles,a.YnumberOfTiles,parseInt(a.XnumberOfTiles/2),parseInt(a.YnumberOfTiles/2));a.setCenter(a.WGScenter.lat,a.WGScenter.lon);a.fireEvent("idle")};this.withinBounds=function(c,b){return c>=a.bounds[0]&&
c<=a.bounds[2]&&b>=a.bounds[1]&&b<=a.bounds[3]?!0:!1};this.getCenter=function(){var c=s(a.zeroTile.x,a.zeroTile.y,a.zoom),c=t(c.x,c.y,a.zoom);return{lat:c[2]-(c[2]-c[0])/a.tileSize*(-1*a.yOffset+a.height/2),lon:c[1]+(c[3]-c[1])/a.tileSize*(-1*a.xOffset+a.width/2)}};this.zoomIn=function(){var c=a.getCenter();a.setCenter(c.lat,c.lon,a.zoom+1)};this.zoomOut=function(){var c=a.getCenter();a.setCenter(c.lat,c.lon,a.zoom-1)};this.setCenter=function(c,b,d){d="undefined"==typeof d?a.zoom:d;a.withinBounds(c,
b)&&d==a.zoom?(b=x(c,b,a.zeroTile.x,a.zeroTile.y,d),c=-1*(parseInt(b.x)-parseInt(a.width/2)),b=-1*(parseInt(b.y)-parseInt(a.height/2)),u(c,b)):a.reallocateMap(c,b,d,!1)};a.calculateSize=function(){a.XnumberOfTiles=parseInt(a.width/a.tileSize)+1;a.YnumberOfTiles=parseInt(a.height/a.tileSize)+1;1==a.XnumberOfTiles&&(a.XnumberOfTiles=3);1==a.YnumberOfTiles&&(a.YnumberOfTiles=3);a.XnumberOfTiles=0==parseFloat(a.XnumberOfTiles)%2?a.XnumberOfTiles+1:a.XnumberOfTiles;a.YnumberOfTiles=0==parseFloat(a.YnumberOfTiles)%
2?a.YnumberOfTiles+1:a.YnumberOfTiles;a.Xcenter=parseInt(parseFloat(a.XnumberOfTiles)/2);a.Ycenter=parseInt(parseFloat(a.YnumberOfTiles)/2);a.rightEdge=parseInt(a.XnumberOfTiles*a.tileSize)-a.width;a.topEdge=parseInt(a.YnumberOfTiles*a.tileSize)-a.height;a.leftEdge=0;a.bottomEdge=0;a.minX=0;a.minY=0;a.mousePosition=new y;a.mouseLocations=[];a.velocity=new y;a.timerId=-1;a.timerCount=0};a.reallocateMap=function(c,b,d,g){a.reallocating=!0;a.movingMap=!0;g="undefined"==typeof g?!1:g;for(var e=0;e<a.tiles.length;e++)for(var f=
0;f<a.tiles[e].length;f++)for(var j=0;j<a.tiles[e][f].length;j++)a.tiles[e][f][j].parentNode.removeChild(a.tiles[e][f][j]),a.tiles[e][f]=[];a.map=document.getElementById(h.id);a.map.innerHTML="";a.WGScenter.lat=c;a.WGScenter.lon=b;a.zoom=d;a.calculateSize();a.mouseDown&&a.removeListener(document,"mousemove",z);a.mouseDown=!1;a.center=l(c,b,d,!1);a.tiles=[];for(e=0;e<a.XnumberOfTiles;e++){a.tiles.push([]);for(f=0;f<a.YnumberOfTiles;f++)c=a.center.x-a.Xcenter+e,b=a.center.y-a.Ycenter+f,a.tiles[e].push(B(a.map,
d,c,b,e,f)),0==e&&0==f?(a.zeroTile.x=c,a.zeroTile.y=b,j=s(c,b,d),j=t(j.x,j.y,d),a.bounds[2]=j[2],a.bounds[1]=j[1],a.boundsTMS[2]=c,a.boundsTMS[1]=b):e+1==a.XnumberOfTiles&&f+1==a.YnumberOfTiles&&(j=s(c,b,d),j=t(j.x,j.y,d),a.bounds[0]=j[0],a.bounds[3]=j[3],a.boundsTMS[0]=c,a.boundsTMS[3]=b)}A();a.reallocating=!1;a.movingMap=!1;g||a.getAllTiles()};var z=function(c){var b=c.clientX-a.mousePosition.x+parseInt(a.map.style.left),d=c.clientY-a.mousePosition.y+parseInt(a.map.style.top);u(b,d);a.mousePosition.x=
c.clientX;a.mousePosition.y=c.clientY},E=function(){if(a.mouseDown)a.mouseLocations.unshift(new y(a.mousePosition.x,a.mousePosition.y)),10<a.mouseLocations.length&&a.mouseLocations.pop();else{var c=a.scrollTime/20,b=(c-a.timerCount)/c,d=a.velocity.y*b;u(-(a.velocity.x*b)+parseInt(a.map.style.left),-d+parseInt(a.map.style.top));if(a.timerCount>=c||"undefined"==typeof b)clearInterval(a.timerId),a.timerId=-1,a.fireEvent("idle");++a.timerCount}};a.moveToPosition=function(c,b){var d=a.width,g=a.height;
a.mousePosition.x=c;a.mousePosition.y=b;c<0.15*d&&a.moveMap(-0.05,0);c>0.85*d&&a.moveMap(0.05,0);b<0.15*g&&a.moveMap(0,-0.05);b>0.85*g&&a.moveMap(0,0.05)};a.mouseover=function(c){var b=c.clientX,d=c.clientY;a.mousePosition.x=c.clientX;a.mousePosition.y=c.clientY;a.moveToPosition(b,d)};a.click=function(c){a.moveToPosition(c.clientX,c.clientY)};a.mousedown=function(c){a.viewingBox.style.cursor="url(data:image/x-win-bitmap;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAAH/AAAB/wAAA/0AAANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//+AB///wAf//4AH//+AD///yT/////////////////////////////8=), default";
a.mousePosition.x=c.clientX;a.mousePosition.y=c.clientY;a.AddListener(document,"mousemove",z);a.mouseDown=!0;a.scrolling?(a.timerCount=0,0>=a.timerId&&(clearInterval(a.timerId),a.timerId=0,a.timerId=setInterval(E,20))):a.fireEvent("idle");c.preventDefault()};a.mouseup=function(){if(a.mouseDown&&(a.removeListener(document,"mousemove",z),a.mouseDown=!1,0<a.mouseLocations.length)){var c=a.mouseLocations.length;a.velocity.x=(a.mouseLocations[c-1].x-a.mouseLocations[0].x)/c;a.velocity.y=(a.mouseLocations[c-
1].y-a.mouseLocations[0].y)/c;a.mouseLocations.length=0}0>=a.timerId&&a.fireEvent("idle");a.viewingBox.style.cursor="auto"};this.Marker=function(c){var b=this;b.draw=function(){var c=x(d,g,a.zeroTile.x,a.zeroTile.y,a.zoom),h="undefined"==typeof b.img||null==b.img?document.createElement("img"):b.img;h.src=e;h.style.zIndex=3;h.style.left=parseInt(c.x-f)+"px";h.style.top=parseInt(c.y-j)+"px";h.style.position="absolute";b.img=h;b.drawed=!0;a.map.appendChild(h)};b.removeFromMap=function(){b.img.parentNode&&
b.img.parentNode.removeChild(b.img);b.img=null;b.drawed=!1};b.boundsChanged=function(){b.drawed?a.withinBounds(d,g)?b.draw():(b.removeFromMap(),a.onHoldMarkers.push(b)):a.withinBounds(d,g)&&(a.onHoldMarkers.remove(b),b.draw())};b.destroy=function(){b.removeFromMap();a.markers.remove(b)};var d=c.lat,g=c.lon,e="undefined"==typeof c.src?"resources/arrow.png":c.src,f="undefined"==typeof c.xoffset?0:c.xoffset,j="undefined"==typeof c.yoffset?0:c.yoffset;b.lat=d;b.lon=g;b.src=e;b.drawed=!1;b.x=null;b.y=
null;a.withinBounds(d,g)?b.draw():a.onHoldMarkers.push(b);a.markers.push(b)};a.firsttime=!0;a.id=h.id;a.map=document.getElementById(h.id);a.map.innerHTML="";a.WGScenter="undefined"==typeof h.center?{lon:-99.17158864746091,lat:19.424792788880602}:h.center;a.zoom="undefined"==typeof h.zoom?15:h.zoom;a.width="undefined"==typeof h.width?800:h.width;a.height="undefined"==typeof h.height?600:h.height;a.tileSize="undefined"==typeof h.tileSize?256:h.tileSize;a.scrolling="undefined"==typeof h.scrolling?!0:
h.scrolling;a.scrollTime="undefined"==typeof h.scrollTime?300:h.scrollTime;a.controls="undefined"==typeof h.controls?!0:h.controls;a.container="undefined"==typeof h.container?"container":h.container;a.loading="undefined"==typeof h.loading?"resources/loading_caption.png":h.loading;"undefined"!=typeof h.getURL&&(a.getURL=h.getURL);a.initialResolution=12756274*Math.PI/a.tileSize;a.originShift=12756274*Math.PI/2;a.viewingBox=document.createElement("div");a.viewingBox.id="undefined"==typeof h.divID?"viewingBox":
h.divID;a.map.parentNode.replaceChild(a.viewingBox,a.map);a.viewingBox.appendChild(a.map);a.viewingBox.style.overflow="hidden";a.viewingBox.style.width=a.width+"px";a.viewingBox.style.height=a.height+"px";a.viewingBox.style.position="relative";a.over=!1;if(a.controls){var D=a.viewingBox.parentNode,k=document.createElement("img");k.src="resources/plus.png";k.id="zoominbutton";k.style.zIndex=5;k.style.left=parseInt(a.width-55)+"px";k.style.top="5px";k.style.position="absolute";a.AddListener(k,"click",
a.zoomIn);D.appendChild(k);k=document.createElement("img");k.src="resources/minus.png";k.id="zoominout";k.style.zIndex=5;k.style.left=parseInt(a.width-55)+"px";k.style.top="60px";k.style.position="absolute";a.AddListener(k,"click",a.zoomOut);D.appendChild(k)}a.map.style.position="absolute";"undefined"!=typeof h.cssClass&&(a.viewingBox.className=h.cssClass);a.calculateSize();a.mouseDown=!1;a.reallocating=!1;a.markers=[];a.onHoldMarkers=[];a.movingMap=!1;a.tiles=Array(1);a.tiles[0]=[];a.bounds=Array(4);
a.boundsTMS=Array(4);a.latLonBounds=Array(4);a.zeroTile={};a.xOffsetCenter=-1*(parseInt(a.XnumberOfTiles*a.tileSize/2)-parseInt(a.width/2));a.yOffsetCenter=-1*(parseInt(a.YnumberOfTiles*a.tileSize/2)-parseInt(a.height/2));a.xOffset=a.xOffsetCenter;a.yOffset=a.yOffsetCenter;a.reallocateMap(a.WGScenter.lat,a.WGScenter.lon,a.zoom,!0);a.AddListener(a.viewingBox,"mousedown",a.mousedown);a.AddListener(document,"mouseup",a.mouseup);a.AddListener(a.viewingBox,"click",a.click)};