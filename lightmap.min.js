/*
<beginLegalBanter>
The MIT License (MIT)
Copyright (c) 2012 Francisco Valdez de la Fuente
Copyright (c) 2011 Charlie Andrews
Copyright (c) 2007 Klokan Petr Pridal


Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files 
(the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, 
merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is 
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE 
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR 
IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</endLegalBanter>
*/
Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b=b||0;for(var c=this.length;c>b;){if(this[b]===a)return b;++b}return-1}),Array.prototype.remove=function(){for(var a,d,b=arguments,c=b.length;c&&this.length;)for(a=b[--c];-1!=(d=this.indexOf(a));)this.splice(d,1);return this};var LightMap=function(){var a=function b(a){function d(){for(var a=0;c.markers.length>a;a++)c.markers[a].boundsChanged()}function e(){d()}function f(a,d){if(!(0==a&&0==d||c.reallocating)){c.reallocating=!0;var f=1,g=c.XnumberOfTiles+(0!=a?f:0),h=c.YnumberOfTiles+(0!=d?f:0),j=a*f,k=d*f;c.Xcenter+=j,c.Ycenter+=k,c.center.x+=j,c.center.y+=k,0>a&&(c.leftEdge+=-1*j*c.tileSize),0>d&&(c.bottomEdge+=-1*k*c.tileSize),a>0&&(c.rightEdge+=j*c.tileSize),d>0&&(c.topEdge+=k*c.tileSize);for(var l=Array(),m=0;g>m;m++){l.push(Array());for(var n=0;h>n;n++){var o=c.center.x-c.Xcenter+m+j+c.minX,p=c.center.y-c.Ycenter+n+k+c.minY;if(m+j>=0&&c.XnumberOfTiles>m+j&&c.YnumberOfTiles>n+k&&n+k>=0?l[m].push(c.tiles[m+j][n+k]):(l[m].push(i(c.map,c.zoom,o,p,m+j+c.minX,n+k+c.minY)),c.getTile(l[m][n],c.zoom,o,p,m+j+c.minX,n+k+c.minY)),0==m&&0==n){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,c.zoom));var r=b.TileLatLonBounds(q.x,q.y,c.zoom,c.tileSize,c.initialResolution);c.bounds[2]=r[2],c.bounds[1]=r[1],c.boundsTMS[2]=o,c.boundsTMS[1]=p,r=null}else if(m+1==g&&n+1==h){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,c.zoom));var r=b.TileLatLonBounds(q.x,q.y,c.zoom,c.tileSize,c.initialResolution);c.bounds[0]=r[0],c.bounds[3]=r[3],c.boundsTMS[0]=o,c.boundsTMS[3]=p,r=null}}}c.XnumberOfTiles=g,c.YnumberOfTiles=h,c.tiles=null,c.tiles=l,0>a&&(c.minX+=j),0>d&&(c.minY+=k),e(),c.reallocating=!1}}function g(a,b){if(!c.movingMap)try{var d=a,e=b,g=0,h=0;-c.rightEdge>d&&(d=-c.rightEdge,g=1),-c.topEdge>e&&(e=-c.topEdge,h=1),d>c.leftEdge&&(d=c.leftEdge,g=-1),e>c.bottomEdge&&(e=c.bottomEdge,h=-1),f(g,h),c.map.style.left=d+"px",c.map.style.top=e+"px",c.xOffset=d,c.yOffset=e}catch(i){alert(i)}}function h(a,b,d,e,f){var g=2*a-1;if(!(g>b&&g>d&&0!=b%2&&0!=d%2||g>b+1&&g>d&&0==b%2&&0!=d%2||g>b&&g>d+1&&0!=b%2&&0==d%2||g>b+1&&g>d+1&&0==b%2&&0==d%2)){if(2>a)1==a&&c.getTile(c.tiles[e][f],c.zoom,c.center.x-c.Xcenter+e,c.center.y-c.Ycenter+f,e,f);else for(var i=e-a+1;e+a>i;i++)for(var j=f-a+1;f+a>j;j++)b>i&&d>j&&(i==e-a+1||i==e+a-1||j==f-a+1||j==f+a-1)&&i>=0&&j>=0&&c.getTile(c.tiles[i][j],c.zoom,c.center.x-c.Xcenter+i,c.center.y-c.Ycenter+j,i,j);h(a+1,b,d,e,f)}}function i(a,b,d,e,f,g){f=parseInt(f*c.tileSize)+"px",g=parseInt(g*c.tileSize)+"px";var h=Array(),i=document.createElement("img");return i.src=c.loading,i.style.left=f,i.style.top=g,i.style.position="absolute",i.style.zIndex=0,h.push(i),a.appendChild(i),h}function l(a,b){this.x=a,this.y=b}var c=this;this.withInViewport=function(a,d){if(!c.withinBounds(a,d))return!1;var e=b.LatLonToPixels(a,d,c.zeroTile.x,c.zeroTile.y,c.zoom,c.tms,c.tileSize,c.initialResolution);return e.x>-1*c.xOffset&&e.x<c.width+-1*c.xOffset&&e.y>-1*c.yOffset&&e.y<c.height+-1*c.yOffset},this.moveMap=function(a,b){g(parseInt(c.xOffset+a*-c.tileSize),parseInt(c.yOffset+b*-c.tileSize)),c.fireEvent("idle")},this.AddListener=function(a,b,c){a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)},this.removeListener=function(a,b,c){a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)},this.fireEvent=function(a){if(document.addEventListener){var b=document.createEvent("UIEvents");b.initEvent(a,!1,!1),document.dispatchEvent(b)}else document.attachEvent&&document.documentElement[a]++},this.addCustomEvent=function(a,b){document.addEventListener?document.addEventListener(a,function(a){b(a)},!1):document.attachEvent&&(document.documentElement[a]=0,document.documentElement.attachEvent("onpropertychange",function(c){c.propertyName==a&&b(c)}))},this.getURL=function(a,b,c){var d=["a","b","c"],e=d[Math.floor(Math.random()*d.length)];return"http://"+e+".tile.openstreetmap.org/"+a+"/"+b+"/"+c+".png"},this.getTile=function(a,b,d,e,f,g){f=parseInt(f*c.tileSize)+"px",g=parseInt(g*c.tileSize)+"px";var h=document.createElement("img");for(h.src=c.getURL(b,d,e),h.style.zIndex=0,h.style.left=f,h.style.top=g,h.name="default",h.style.position="absolute",c.firsttime&&(h.id="default"+b+"_"+d+"_"+e);a.length>0;)a[0].parentNode.removeChild(a[0]),a.remove(a[0]);c.map.appendChild(h),a.push(h)},this.getAllTiles=function(){h(1,c.XnumberOfTiles,c.YnumberOfTiles,parseInt(c.XnumberOfTiles/2),parseInt(c.YnumberOfTiles/2)),c.setCenter(c.WGScenter.lat,c.WGScenter.lon),c.fireEvent("idle")},this.withinBounds=function(a,b){return a>=c.bounds[0]&&c.bounds[2]>=a&&b>=c.bounds[1]&&c.bounds[3]>=b?!0:!1},this.getCenter=function(){var a={x:c.zeroTile.x,y:c.zeroTile.y};c.tms||(a=b.GoogleTile(c.zeroTile.x,c.zeroTile.y,c.zoom));var d=b.TileLatLonBounds(a.x,a.y,c.zoom,c.tileSize,c.initialResolution),e=d[2]-(d[2]-d[0])/c.tileSize*(-1*c.yOffset+c.height/2),f=d[1]+(d[3]-d[1])/c.tileSize*(-1*c.xOffset+c.width/2);return{lat:e,lon:f}},this.zoomIn=function(){var a=c.getCenter();c.setCenter(a.lat,a.lon,c.zoom+1)},this.zoomOut=function(){var a=c.getCenter();c.setCenter(a.lat,a.lon,c.zoom-1)},this.setCenter=function(a,d,e){if(e=e===void 0?c.zoom:e,c.withinBounds(a,d)&&e==c.zoom){var f=b.LatLonToPixels(a,d,c.zeroTile.x,c.zeroTile.y,e,c.tms,c.tileSize,c.initialResolution),h=-1*(parseInt(f.x)-parseInt(c.width/2)),i=-1*(parseInt(f.y)-parseInt(c.height/2));g(h,i)}else c.reallocateMap(a,d,e,!1)},this.calculateSize=function(){c.XnumberOfTiles=parseInt(c.width/c.tileSize)+1,c.YnumberOfTiles=parseInt(c.height/c.tileSize)+1,1==c.XnumberOfTiles&&(c.XnumberOfTiles=3),1==c.YnumberOfTiles&&(c.YnumberOfTiles=3),c.XnumberOfTiles=0==parseFloat(c.XnumberOfTiles)%2?c.XnumberOfTiles+1:c.XnumberOfTiles,c.YnumberOfTiles=0==parseFloat(c.YnumberOfTiles)%2?c.YnumberOfTiles+1:c.YnumberOfTiles,c.Xcenter=parseInt(parseFloat(c.XnumberOfTiles)/2),c.Ycenter=parseInt(parseFloat(c.YnumberOfTiles)/2),c.rightEdge=parseInt(c.XnumberOfTiles*c.tileSize)-c.width,c.topEdge=parseInt(c.YnumberOfTiles*c.tileSize)-c.height,c.leftEdge=0,c.bottomEdge=0,c.minX=0,c.minY=0,c.mousePosition=new l,c.mouseLocations=[],c.velocity=new l,c.timerId=-1,c.timerCount=0},this.reallocateMap=function(d,f,g,h){c.reallocating=!0,c.movingMap=!0,h=h===void 0?!1:h;for(var k=0;c.tiles.length>k;k++)for(var l=0;c.tiles[k].length>l;l++)for(var m=0;c.tiles[k][l].length>m;m++)c.tiles[k][l][m].parentNode.removeChild(c.tiles[k][l][m]),c.tiles[k][l]=Array();if(c.map=document.getElementById(a.id),c.map.innerHTML="",c.WGScenter.lat=d,c.WGScenter.lon=f,c.zoom=g,c.calculateSize(),c.mouseDown){var n=j;c.removeListener(document,"mousemove",n)}c.mouseDown=!1,c.center=b.LatLonToTile(d,f,g,c.tms,c.tileSize,c.initialResolution),c.tiles=Array();for(var k=0;c.XnumberOfTiles>k;k++){c.tiles.push(Array());for(var l=0;c.YnumberOfTiles>l;l++){var o=c.center.x-c.Xcenter+k,p=c.center.y-c.Ycenter+l;if(c.tiles[k].push(i(c.map,g,o,p,k,l)),0==k&&0==l){c.zeroTile.x=o,c.zeroTile.y=p;var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,g));var r=b.TileLatLonBounds(q.x,q.y,g,c.tileSize,c.initialResolution);c.bounds[2]=r[2],c.bounds[1]=r[1],c.boundsTMS[2]=o,c.boundsTMS[1]=p,r=null}else if(k+1==c.XnumberOfTiles&&l+1==c.YnumberOfTiles){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,g));var r=b.TileLatLonBounds(q.x,q.y,g,c.tileSize,c.initialResolution);c.bounds[0]=r[0],c.bounds[3]=r[3],c.boundsTMS[0]=o,c.boundsTMS[3]=p,r=null}}}e(),c.reallocating=!1,c.movingMap=!1,h||c.getAllTiles()};var j=function(a){var b=a.clientX-c.mousePosition.x+parseInt(c.map.style.left),d=a.clientY-c.mousePosition.y+parseInt(c.map.style.top);g(b,d),c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY},k=function(){if(c.mouseDown)c.mouseLocations.unshift(new l(c.mousePosition.x,c.mousePosition.y)),c.mouseLocations.length>10&&c.mouseLocations.pop();else{var a=c.scrollTime/20,b=(a-c.timerCount)/a,d=c.velocity.x*b,e=c.velocity.y*b;g(-d+parseInt(c.map.style.left),-e+parseInt(c.map.style.top)),(c.timerCount>=a||b===void 0)&&(clearInterval(c.timerId),c.timerId=-1,c.fireEvent("idle")),++c.timerCount}};if(this.mousewheel=function(a){if(c.mousewheelZooming){var a=window.event||a,b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));b>0?c.zoomIn():c.zoomOut()}},this.moveToPosition=function(a,b){var d=c.width,e=c.height;c.mousePosition.x=a,c.mousePosition.y=b;var f=.15,g=.05;d*f>a&&c.moveMap(-g,0),a>d*(1-f)&&c.moveMap(g,0),e*f>b&&c.moveMap(0,-g),b>e*(1-f)&&c.moveMap(0,g)},this.mouseover=function(a){var b=a.clientX,d=a.clientY;c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY,c.moveToPosition(b,d)},this.click=function(a){c.moveToPosition(a.clientX,a.clientY)},this.mousedown=function(a){c.viewingBox.style.cursor="url(data:image/x-win-bitmap;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAAH/AAAB/wAAA/0AAANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//+AB///wAf//4AH//+AD///yT/////////////////////////////8=), default",c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY,c.AddListener(document,"mousemove",j),c.mouseDown=!0,c.scrolling?(c.timerCount=0,0>=c.timerId&&(clearInterval(c.timerId),c.timerId=0,c.timerId=setInterval(k,20))):c.fireEvent("idle"),a.preventDefault()},this.mouseup=function(){if(c.mouseDown){var a=j;if(c.removeListener(document,"mousemove",a),c.mouseDown=!1,c.mouseLocations.length>0){var b=c.mouseLocations.length;c.velocity.x=(c.mouseLocations[b-1].x-c.mouseLocations[0].x)/b,c.velocity.y=(c.mouseLocations[b-1].y-c.mouseLocations[0].y)/b,c.mouseLocations.length=0}}0>=c.timerId&&c.fireEvent("idle"),c.viewingBox.style.cursor="auto"},this.Marker=function(a){var d=this;d.draw=function(){var a=b.LatLonToPixels(e,f,c.zeroTile.x,c.zeroTile.y,c.zoom,c.tms,c.tileSize,c.initialResolution),j=d.img===void 0||null==d.img?document.createElement("img"):d.img;j.src=g,j.style.zIndex=3,j.style.left=parseInt(a.x-h)+"px",j.style.top=parseInt(a.y-i)+"px",j.style.position="absolute",d.img=j,d.drawed=!0,c.map.appendChild(j)},d.removeFromMap=function(){d.img.parentNode&&d.img.parentNode.removeChild(d.img),d.img=null,d.drawed=!1},d.boundsChanged=function(){d.drawed?c.withinBounds(e,f)?d.draw():(d.removeFromMap(),c.onHoldMarkers.push(d)):c.withinBounds(e,f)&&(c.onHoldMarkers.remove(d),d.draw())},d.destroy=function(){d.removeFromMap(),c.markers.remove(d)};var e=a.lat,f=a.lon,g=a.src===void 0?"resources/arrow.png":a.src,h=a.xoffset===void 0?0:a.xoffset,i=a.yoffset===void 0?0:a.yoffset;d.lat=e,d.lon=f,d.src=g,d.drawed=!1,d.x=null,d.y=null,c.withinBounds(e,f)?d.draw():c.onHoldMarkers.push(d),c.markers.push(d)},c.firsttime=!0,c.id=a.id,c.map=document.getElementById(a.id),c.map.innerHTML="",c.WGScenter=a.center===void 0?{lon:-99.17158864746091,lat:19.424792788880602}:a.center,c.zoom=a.zoom===void 0?15:a.zoom,c.width=a.width===void 0?800:a.width,c.height=a.height===void 0?600:a.height,c.tileSize=a.tileSize===void 0?b.tileSize:a.tileSize,c.scrolling=a.scrolling===void 0?!0:a.scrolling,c.scrollTime=a.scrollTime===void 0?300:a.scrollTime,c.controls=a.controls===void 0?!0:a.controls,c.container=a.container===void 0?"container":a.container,c.loading=a.loading===void 0?"resources/loading_caption.png":a.loading,c.tms=a.tms===void 0?!1:a.tms,c.mousewheelZooming=a.mousewheelZooming===void 0?!0:a.mousewheelZooming,a.getURL!==void 0&&(c.getURL=a.getURL),c.initialResolution=b.InitialResolution(c.tileSize),c.viewingBox=document.createElement("div"),c.viewingBox.id=a.divID===void 0?"viewingBox":a.divID,c.map.parentNode.replaceChild(c.viewingBox,c.map),c.viewingBox.appendChild(c.map),c.viewingBox.style.overflow="hidden",c.viewingBox.style.width=c.width+"px",c.viewingBox.style.height=c.height+"px",c.viewingBox.style.position="relative",c.over=!1,c.controls){var m=c.viewingBox.parentNode,n=document.createElement("img");n.src="resources/plus.png",n.id="zoominbutton",n.style.zIndex=5,n.style.left=parseInt(c.width-55)+"px",n.style.top="5px",n.style.position="absolute",c.AddListener(n,"click",c.zoomIn),m.appendChild(n),n=document.createElement("img"),n.src="resources/minus.png",n.id="zoominout",n.style.zIndex=5,n.style.left=parseInt(c.width-55)+"px",n.style.top="60px",n.style.position="absolute",c.AddListener(n,"click",c.zoomOut),m.appendChild(n)}c.map.style.position="absolute",a.cssClass!==void 0&&(c.viewingBox.className=a.cssClass),c.calculateSize(),c.mouseDown=!1,c.reallocating=!1,c.markers=Array(),c.onHoldMarkers=Array(),c.movingMap=!1,c.tiles=Array(1),c.tiles[0]=Array(),c.bounds=Array(4),c.boundsTMS=Array(4),c.latLonBounds=Array(4),c.zeroTile={},c.xOffsetCenter=-1*(parseInt(c.XnumberOfTiles*c.tileSize/2)-parseInt(c.width/2)),c.yOffsetCenter=-1*(parseInt(c.YnumberOfTiles*c.tileSize/2)-parseInt(c.height/2)),c.xOffset=c.xOffsetCenter,c.yOffset=c.yOffsetCenter,c.reallocateMap(c.WGScenter.lat,c.WGScenter.lon,c.zoom,!0),c.AddListener(c.viewingBox,"mousewheel",c.mousewheel),c.AddListener(c.viewingBox,"mousedown",c.mousedown),c.AddListener(document,"mouseup",c.mouseup),c.AddListener(c.viewingBox,"click",c.click)};return a.tileSize=256,a.initialResolution=6378137*2*Math.PI/a.tileSize,a.originShift=6378137*2*Math.PI/2,a.LatLonToMeters=function(a,c){var d=c*b.originShift/180,e=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return e=e*b.originShift/180,{x:d,y:e}},a.Resolution=function(a,c){return c===void 0&&(c=b.initialResolution),c/parseFloat(Math.pow(2,a))},a.MetersToPixels=function(a,c,d,e){e===void 0&&(e=b.initialResolution);var f=b.Resolution(d,e),g=(a+b.originShift)/f,h=(c+b.originShift)/f;return{x:g,y:h}},a.PixelsToTile=function(a,c,d){d===void 0&&(d=b.tileSize);var e=parseInt(Math.ceil(a/parseFloat(d))-1),f=parseInt(Math.ceil(c/parseFloat(d))-1);return{x:e,y:f}},a.MetersToTile=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.MetersToPixels(a,c,d,f);return b.PixelsToTile(g.x,g.y,e)},a.LatLonToTile=function(a,c,d,e,f,g){f===void 0&&(f=b.tileSize),g===void 0&&(g=f==b.tileSize?b.initialResolution:b.InitialResolution(f));var h=b.LatLonToMeters(a,c);return h=b.MetersToTile(h.x,h.y,d,f,g),e?h:b.GoogleTile(h.x,h.y,d)},a.InitialResolution=function(a){return a===void 0&&(a=b.tileSize),a==b.tileSize?b.initialResolution:6378137*2*Math.PI/a},a.GoogleTile=function(a,b,c){return{x:a,y:Math.pow(2,c)-1-b,ty:b}},a.LatLonToPixels=function(a,c,d,e,f,g,h,i){g===void 0&&(g=!1),h===void 0&&(h=b.tileSize),i===void 0&&(i=h==b.tileSize?b.initialResolution:b.InitialResolution(h));var j=b.LatLonToTile(a,c,f,g,h,i),k=null;return k=g?b.TileLatLonBounds(j.x,j.y,f,h,i):b.TileLatLonBounds(j.x,j.ty,f,h,i),{x:(1-(k[3]-c)/(k[3]-k[1]))*h+(j.x-d)*h,y:(k[2]-a)/(k[2]-k[0])*h+(j.y-e)*h}},a.TileLatLonBounds=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.TileBounds(a,c,d,e,f),h=b.MetersToLatLon(g[0],g[1]),i=b.MetersToLatLon(g[2],g[3]);return[h.lat,h.lon,i.lat,i.lon]},a.TileBounds=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.PixelsToMeters(a*e,c*e,d,f),h=b.PixelsToMeters((a+1)*e,(c+1)*e,d,f);return[g.x,g.y,h.x,h.y]},a.MetersToLatLon=function(a,c){var d=180*(a/b.originShift),e=180*(c/b.originShift);return e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2),{lat:e,lon:d}},a.PixelsToMeters=function(a,c,d,e){return e===void 0&&(e=b.initialResolution),res=b.Resolution(d,e),mx=a*res-b.originShift,my=c*res-b.originShift,{x:mx,y:my}},a}();Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b=b||0;for(var c=this.length;c>b;){if(this[b]===a)return b;++b}return-1}),Array.prototype.remove=function(){for(var a,d,b=arguments,c=b.length;c&&this.length;)for(a=b[--c];-1!=(d=this.indexOf(a));)this.splice(d,1);return this};var LightMap=function(){var a=function b(a){function d(){for(var a=0;c.markers.length>a;a++)c.markers[a].boundsChanged()}function e(){d()}function f(a,d){if(!(0==a&&0==d||c.reallocating)){c.reallocating=!0;var f=1,g=c.XnumberOfTiles+(0!=a?f:0),h=c.YnumberOfTiles+(0!=d?f:0),j=a*f,k=d*f;c.Xcenter+=j,c.Ycenter+=k,c.center.x+=j,c.center.y+=k,0>a&&(c.leftEdge+=-1*j*c.tileSize),0>d&&(c.bottomEdge+=-1*k*c.tileSize),a>0&&(c.rightEdge+=j*c.tileSize),d>0&&(c.topEdge+=k*c.tileSize);for(var l=Array(),m=0;g>m;m++){l.push(Array());for(var n=0;h>n;n++){var o=c.center.x-c.Xcenter+m+j+c.minX,p=c.center.y-c.Ycenter+n+k+c.minY;if(m+j>=0&&c.XnumberOfTiles>m+j&&c.YnumberOfTiles>n+k&&n+k>=0?l[m].push(c.tiles[m+j][n+k]):(l[m].push(i(c.map,c.zoom,o,p,m+j+c.minX,n+k+c.minY)),c.getTile(l[m][n],c.zoom,o,p,m+j+c.minX,n+k+c.minY)),0==m&&0==n){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,c.zoom));var r=b.TileLatLonBounds(q.x,q.y,c.zoom,c.tileSize,c.initialResolution);c.bounds[2]=r[2],c.bounds[1]=r[1],c.boundsTMS[2]=o,c.boundsTMS[1]=p,r=null}else if(m+1==g&&n+1==h){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,c.zoom));var r=b.TileLatLonBounds(q.x,q.y,c.zoom,c.tileSize,c.initialResolution);c.bounds[0]=r[0],c.bounds[3]=r[3],c.boundsTMS[0]=o,c.boundsTMS[3]=p,r=null}}}c.XnumberOfTiles=g,c.YnumberOfTiles=h,c.tiles=null,c.tiles=l,0>a&&(c.minX+=j),0>d&&(c.minY+=k),e(),c.reallocating=!1}}function g(a,b){if(!c.movingMap)try{var d=a,e=b,g=0,h=0;-c.rightEdge>d&&(d=-c.rightEdge,g=1),-c.topEdge>e&&(e=-c.topEdge,h=1),d>c.leftEdge&&(d=c.leftEdge,g=-1),e>c.bottomEdge&&(e=c.bottomEdge,h=-1),f(g,h),c.map.style.left=d+"px",c.map.style.top=e+"px",c.xOffset=d,c.yOffset=e}catch(i){alert(i)}}function h(a,b,d,e,f){var g=2*a-1;if(!(g>b&&g>d&&0!=b%2&&0!=d%2||g>b+1&&g>d&&0==b%2&&0!=d%2||g>b&&g>d+1&&0!=b%2&&0==d%2||g>b+1&&g>d+1&&0==b%2&&0==d%2)){if(2>a)1==a&&c.getTile(c.tiles[e][f],c.zoom,c.center.x-c.Xcenter+e,c.center.y-c.Ycenter+f,e,f);else for(var i=e-a+1;e+a>i;i++)for(var j=f-a+1;f+a>j;j++)b>i&&d>j&&(i==e-a+1||i==e+a-1||j==f-a+1||j==f+a-1)&&i>=0&&j>=0&&c.getTile(c.tiles[i][j],c.zoom,c.center.x-c.Xcenter+i,c.center.y-c.Ycenter+j,i,j);h(a+1,b,d,e,f)}}function i(a,b,d,e,f,g){f=parseInt(f*c.tileSize)+"px",g=parseInt(g*c.tileSize)+"px";var h=Array(),i=document.createElement("img");return i.src=c.loading,i.style.left=f,i.style.top=g,i.style.position="absolute",i.style.zIndex=0,h.push(i),a.appendChild(i),h}function l(a,b){this.x=a,this.y=b}var c=this;this.withInViewport=function(a,d){if(!c.withinBounds(a,d))return!1;var e=b.LatLonToPixels(a,d,c.zeroTile.x,c.zeroTile.y,c.zoom,c.tms,c.tileSize,c.initialResolution);return e.x>-1*c.xOffset&&e.x<c.width+-1*c.xOffset&&e.y>-1*c.yOffset&&e.y<c.height+-1*c.yOffset},this.moveMap=function(a,b){g(parseInt(c.xOffset+a*-c.tileSize),parseInt(c.yOffset+b*-c.tileSize)),c.fireEvent("idle")},this.AddListener=function(a,b,c){a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)},this.removeListener=function(a,b,c){a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)},this.fireEvent=function(a){if(document.addEventListener){var b=document.createEvent("UIEvents");b.initEvent(a,!1,!1),document.dispatchEvent(b)}else document.attachEvent&&document.documentElement[a]++},this.addCustomEvent=function(a,b){document.addEventListener?document.addEventListener(a,function(a){b(a)},!1):document.attachEvent&&(document.documentElement[a]=0,document.documentElement.attachEvent("onpropertychange",function(c){c.propertyName==a&&b(c)}))},this.getURL=function(a,b,c){var d=["a","b","c"],e=d[Math.floor(Math.random()*d.length)];return"http://"+e+".tile.openstreetmap.org/"+a+"/"+b+"/"+c+".png"},this.getTile=function(a,b,d,e,f,g){f=parseInt(f*c.tileSize)+"px",g=parseInt(g*c.tileSize)+"px";var h=document.createElement("img");for(h.src=c.getURL(b,d,e),h.style.zIndex=0,h.style.left=f,h.style.top=g,h.name="default",h.style.position="absolute",c.firsttime&&(h.id="default"+b+"_"+d+"_"+e);a.length>0;)a[0].parentNode.removeChild(a[0]),a.remove(a[0]);c.map.appendChild(h),a.push(h)},this.getAllTiles=function(){h(1,c.XnumberOfTiles,c.YnumberOfTiles,parseInt(c.XnumberOfTiles/2),parseInt(c.YnumberOfTiles/2)),c.setCenter(c.WGScenter.lat,c.WGScenter.lon),c.fireEvent("idle")},this.withinBounds=function(a,b){return a>=c.bounds[0]&&c.bounds[2]>=a&&b>=c.bounds[1]&&c.bounds[3]>=b?!0:!1},this.getCenter=function(){var a={x:c.zeroTile.x,y:c.zeroTile.y};c.tms||(a=b.GoogleTile(c.zeroTile.x,c.zeroTile.y,c.zoom));var d=b.TileLatLonBounds(a.x,a.y,c.zoom,c.tileSize,c.initialResolution),e=d[2]-(d[2]-d[0])/c.tileSize*(-1*c.yOffset+c.height/2),f=d[1]+(d[3]-d[1])/c.tileSize*(-1*c.xOffset+c.width/2);return{lat:e,lon:f}},this.zoomIn=function(){var a=c.getCenter();c.setCenter(a.lat,a.lon,c.zoom+1)},this.zoomOut=function(){var a=c.getCenter();c.setCenter(a.lat,a.lon,c.zoom-1)},this.setCenter=function(a,d,e){if(e=e===void 0?c.zoom:e,c.withinBounds(a,d)&&e==c.zoom){var f=b.LatLonToPixels(a,d,c.zeroTile.x,c.zeroTile.y,e,c.tms,c.tileSize,c.initialResolution),h=-1*(parseInt(f.x)-parseInt(c.width/2)),i=-1*(parseInt(f.y)-parseInt(c.height/2));g(h,i)}else c.reallocateMap(a,d,e,!1)},this.calculateSize=function(){c.XnumberOfTiles=parseInt(c.width/c.tileSize)+1,c.YnumberOfTiles=parseInt(c.height/c.tileSize)+1,1==c.XnumberOfTiles&&(c.XnumberOfTiles=3),1==c.YnumberOfTiles&&(c.YnumberOfTiles=3),c.XnumberOfTiles=0==parseFloat(c.XnumberOfTiles)%2?c.XnumberOfTiles+1:c.XnumberOfTiles,c.YnumberOfTiles=0==parseFloat(c.YnumberOfTiles)%2?c.YnumberOfTiles+1:c.YnumberOfTiles,c.Xcenter=parseInt(parseFloat(c.XnumberOfTiles)/2),c.Ycenter=parseInt(parseFloat(c.YnumberOfTiles)/2),c.rightEdge=parseInt(c.XnumberOfTiles*c.tileSize)-c.width,c.topEdge=parseInt(c.YnumberOfTiles*c.tileSize)-c.height,c.leftEdge=0,c.bottomEdge=0,c.minX=0,c.minY=0,c.mousePosition=new l,c.mouseLocations=[],c.velocity=new l,c.timerId=-1,c.timerCount=0},this.reallocateMap=function(d,f,g,h){c.reallocating=!0,c.movingMap=!0,h=h===void 0?!1:h;for(var k=0;c.tiles.length>k;k++)for(var l=0;c.tiles[k].length>l;l++)for(var m=0;c.tiles[k][l].length>m;m++)c.tiles[k][l][m].parentNode.removeChild(c.tiles[k][l][m]),c.tiles[k][l]=Array();if(c.map=document.getElementById(a.id),c.map.innerHTML="",c.WGScenter.lat=d,c.WGScenter.lon=f,c.zoom=g,c.calculateSize(),c.mouseDown){var n=j;c.removeListener(document,"mousemove",n)}c.mouseDown=!1,c.center=b.LatLonToTile(d,f,g,c.tms,c.tileSize,c.initialResolution),c.tiles=Array();for(var k=0;c.XnumberOfTiles>k;k++){c.tiles.push(Array());for(var l=0;c.YnumberOfTiles>l;l++){var o=c.center.x-c.Xcenter+k,p=c.center.y-c.Ycenter+l;if(c.tiles[k].push(i(c.map,g,o,p,k,l)),0==k&&0==l){c.zeroTile.x=o,c.zeroTile.y=p;var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,g));var r=b.TileLatLonBounds(q.x,q.y,g,c.tileSize,c.initialResolution);c.bounds[2]=r[2],c.bounds[1]=r[1],c.boundsTMS[2]=o,c.boundsTMS[1]=p,r=null}else if(k+1==c.XnumberOfTiles&&l+1==c.YnumberOfTiles){var q={x:o,y:p};c.tms||(q=b.GoogleTile(o,p,g));var r=b.TileLatLonBounds(q.x,q.y,g,c.tileSize,c.initialResolution);c.bounds[0]=r[0],c.bounds[3]=r[3],c.boundsTMS[0]=o,c.boundsTMS[3]=p,r=null}}}e(),c.reallocating=!1,c.movingMap=!1,h||c.getAllTiles()};var j=function(a){var b=a.clientX-c.mousePosition.x+parseInt(c.map.style.left),d=a.clientY-c.mousePosition.y+parseInt(c.map.style.top);g(b,d),c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY},k=function(){if(c.mouseDown)c.mouseLocations.unshift(new l(c.mousePosition.x,c.mousePosition.y)),c.mouseLocations.length>10&&c.mouseLocations.pop();else{var a=c.scrollTime/20,b=(a-c.timerCount)/a,d=c.velocity.x*b,e=c.velocity.y*b;g(-d+parseInt(c.map.style.left),-e+parseInt(c.map.style.top)),(c.timerCount>=a||b===void 0)&&(clearInterval(c.timerId),c.timerId=-1,c.fireEvent("idle")),++c.timerCount}};if(this.mousewheel=function(a){if(c.mousewheelZooming){var a=window.event||a,b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));b>0?c.zoomIn():c.zoomOut()}},this.moveToPosition=function(a,b){var d=c.width,e=c.height;c.mousePosition.x=a,c.mousePosition.y=b;var f=.15,g=.05;d*f>a&&c.moveMap(-g,0),a>d*(1-f)&&c.moveMap(g,0),e*f>b&&c.moveMap(0,-g),b>e*(1-f)&&c.moveMap(0,g)},this.mouseover=function(a){var b=a.clientX,d=a.clientY;c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY,c.moveToPosition(b,d)},this.click=function(a){c.moveToPosition(a.clientX,a.clientY)},this.mousedown=function(a){c.viewingBox.style.cursor="url(data:image/x-win-bitmap;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAAH/AAAB/wAAA/0AAANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//+AB///wAf//4AH//+AD///yT/////////////////////////////8=), default",c.mousePosition.x=a.clientX,c.mousePosition.y=a.clientY,c.AddListener(document,"mousemove",j),c.mouseDown=!0,c.scrolling?(c.timerCount=0,0>=c.timerId&&(clearInterval(c.timerId),c.timerId=0,c.timerId=setInterval(k,20))):c.fireEvent("idle"),a.preventDefault()},this.mouseup=function(){if(c.mouseDown){var a=j;if(c.removeListener(document,"mousemove",a),c.mouseDown=!1,c.mouseLocations.length>0){var b=c.mouseLocations.length;c.velocity.x=(c.mouseLocations[b-1].x-c.mouseLocations[0].x)/b,c.velocity.y=(c.mouseLocations[b-1].y-c.mouseLocations[0].y)/b,c.mouseLocations.length=0}}0>=c.timerId&&c.fireEvent("idle"),c.viewingBox.style.cursor="auto"},this.Marker=function(a){var d=this;d.draw=function(){var a=b.LatLonToPixels(e,f,c.zeroTile.x,c.zeroTile.y,c.zoom,c.tms,c.tileSize,c.initialResolution),j=d.img===void 0||null==d.img?document.createElement("img"):d.img;j.src=g,j.style.zIndex=3,j.style.left=parseInt(a.x-h)+"px",j.style.top=parseInt(a.y-i)+"px",j.style.position="absolute",d.img=j,d.drawed=!0,c.map.appendChild(j)},d.removeFromMap=function(){d.img.parentNode&&d.img.parentNode.removeChild(d.img),d.img=null,d.drawed=!1},d.boundsChanged=function(){d.drawed?c.withinBounds(e,f)?d.draw():(d.removeFromMap(),c.onHoldMarkers.push(d)):c.withinBounds(e,f)&&(c.onHoldMarkers.remove(d),d.draw())},d.destroy=function(){d.removeFromMap(),c.markers.remove(d)};var e=a.lat,f=a.lon,g=a.src===void 0?"resources/arrow.png":a.src,h=a.xoffset===void 0?0:a.xoffset,i=a.yoffset===void 0?0:a.yoffset;d.lat=e,d.lon=f,d.src=g,d.drawed=!1,d.x=null,d.y=null,c.withinBounds(e,f)?d.draw():c.onHoldMarkers.push(d),c.markers.push(d)},c.firsttime=!0,c.id=a.id,c.map=document.getElementById(a.id),c.map.innerHTML="",c.WGScenter=a.center===void 0?{lon:-99.17158864746091,lat:19.424792788880602}:a.center,c.zoom=a.zoom===void 0?15:a.zoom,c.width=a.width===void 0?800:a.width,c.height=a.height===void 0?600:a.height,c.tileSize=a.tileSize===void 0?b.tileSize:a.tileSize,c.scrolling=a.scrolling===void 0?!0:a.scrolling,c.scrollTime=a.scrollTime===void 0?300:a.scrollTime,c.controls=a.controls===void 0?!0:a.controls,c.container=a.container===void 0?"container":a.container,c.loading=a.loading===void 0?"resources/loading_caption.png":a.loading,c.tms=a.tms===void 0?!1:a.tms,c.mousewheelZooming=a.mousewheelZooming===void 0?!0:a.mousewheelZooming,a.getURL!==void 0&&(c.getURL=a.getURL),c.initialResolution=b.InitialResolution(c.tileSize),c.viewingBox=document.createElement("div"),c.viewingBox.id=a.divID===void 0?"viewingBox":a.divID,c.map.parentNode.replaceChild(c.viewingBox,c.map),c.viewingBox.appendChild(c.map),c.viewingBox.style.overflow="hidden",c.viewingBox.style.width=c.width+"px",c.viewingBox.style.height=c.height+"px",c.viewingBox.style.position="relative",c.over=!1,c.controls){var m=c.viewingBox.parentNode,n=document.createElement("img");n.src="resources/plus.png",n.id="zoominbutton",n.style.zIndex=5,n.style.left=parseInt(c.width-55)+"px",n.style.top="5px",n.style.position="absolute",c.AddListener(n,"click",c.zoomIn),m.appendChild(n),n=document.createElement("img"),n.src="resources/minus.png",n.id="zoominout",n.style.zIndex=5,n.style.left=parseInt(c.width-55)+"px",n.style.top="60px",n.style.position="absolute",c.AddListener(n,"click",c.zoomOut),m.appendChild(n)}c.map.style.position="absolute",a.cssClass!==void 0&&(c.viewingBox.className=a.cssClass),c.calculateSize(),c.mouseDown=!1,c.reallocating=!1,c.markers=Array(),c.onHoldMarkers=Array(),c.movingMap=!1,c.tiles=Array(1),c.tiles[0]=Array(),c.bounds=Array(4),c.boundsTMS=Array(4),c.latLonBounds=Array(4),c.zeroTile={},c.xOffsetCenter=-1*(parseInt(c.XnumberOfTiles*c.tileSize/2)-parseInt(c.width/2)),c.yOffsetCenter=-1*(parseInt(c.YnumberOfTiles*c.tileSize/2)-parseInt(c.height/2)),c.xOffset=c.xOffsetCenter,c.yOffset=c.yOffsetCenter,c.reallocateMap(c.WGScenter.lat,c.WGScenter.lon,c.zoom,!0),c.AddListener(c.viewingBox,"mousewheel",c.mousewheel),c.AddListener(c.viewingBox,"mousedown",c.mousedown),c.AddListener(document,"mouseup",c.mouseup),c.AddListener(c.viewingBox,"click",c.click)};return a.tileSize=256,a.initialResolution=6378137*2*Math.PI/a.tileSize,a.originShift=6378137*2*Math.PI/2,a.LatLonToMeters=function(a,c){var d=c*b.originShift/180,e=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return e=e*b.originShift/180,{x:d,y:e}},a.Resolution=function(a,c){return c===void 0&&(c=b.initialResolution),c/parseFloat(Math.pow(2,a))},a.MetersToPixels=function(a,c,d,e){e===void 0&&(e=b.initialResolution);var f=b.Resolution(d,e),g=(a+b.originShift)/f,h=(c+b.originShift)/f;return{x:g,y:h}},a.PixelsToTile=function(a,c,d){d===void 0&&(d=b.tileSize);var e=parseInt(Math.ceil(a/parseFloat(d))-1),f=parseInt(Math.ceil(c/parseFloat(d))-1);return{x:e,y:f}},a.MetersToTile=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.MetersToPixels(a,c,d,f);return b.PixelsToTile(g.x,g.y,e)},a.LatLonToTile=function(a,c,d,e,f,g){f===void 0&&(f=b.tileSize),g===void 0&&(g=f==b.tileSize?b.initialResolution:b.InitialResolution(f));var h=b.LatLonToMeters(a,c);return h=b.MetersToTile(h.x,h.y,d,f,g),e?h:b.GoogleTile(h.x,h.y,d)},a.InitialResolution=function(a){return a===void 0&&(a=b.tileSize),a==b.tileSize?b.initialResolution:6378137*2*Math.PI/a},a.GoogleTile=function(a,b,c){return{x:a,y:Math.pow(2,c)-1-b,ty:b}},a.LatLonToPixels=function(a,c,d,e,f,g,h,i){g===void 0&&(g=!1),h===void 0&&(h=b.tileSize),i===void 0&&(i=h==b.tileSize?b.initialResolution:b.InitialResolution(h));var j=b.LatLonToTile(a,c,f,g,h,i),k=null;return k=g?b.TileLatLonBounds(j.x,j.y,f,h,i):b.TileLatLonBounds(j.x,j.ty,f,h,i),{x:(1-(k[3]-c)/(k[3]-k[1]))*h+(j.x-d)*h,y:(k[2]-a)/(k[2]-k[0])*h+(j.y-e)*h}},a.TileLatLonBounds=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.TileBounds(a,c,d,e,f),h=b.MetersToLatLon(g[0],g[1]),i=b.MetersToLatLon(g[2],g[3]);return[h.lat,h.lon,i.lat,i.lon]},a.TileBounds=function(a,c,d,e,f){e===void 0&&(e=b.tileSize),f===void 0&&(f=e==b.tileSize?b.initialResolution:b.InitialResolution(e));var g=b.PixelsToMeters(a*e,c*e,d,f),h=b.PixelsToMeters((a+1)*e,(c+1)*e,d,f);return[g.x,g.y,h.x,h.y]},a.MetersToLatLon=function(a,c){var d=180*(a/b.originShift),e=180*(c/b.originShift);return e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2),{lat:e,lon:d}},a.PixelsToMeters=function(a,c,d,e){return e===void 0&&(e=b.initialResolution),res=b.Resolution(d,e),mx=a*res-b.originShift,my=c*res-b.originShift,{x:mx,y:my}},a}();